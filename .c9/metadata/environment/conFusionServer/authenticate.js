{"filter":false,"title":"authenticate.js","tooltip":"/conFusionServer/authenticate.js","ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":39,"column":68},"end":{"row":39,"column":68},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"hash":"b0f8ef48515283660e865d200d1cdb50f5a4aee6","undoManager":{"mark":3,"position":3,"stack":[[{"start":{"row":2,"column":36},"end":{"row":3,"column":0},"action":"insert","lines":["",""],"id":6}],[{"start":{"row":3,"column":0},"end":{"row":8,"column":36},"action":"insert","lines":["","var JwtStrategy = require('passport-jwt').Strategy;","var ExtractJwt = require('passport-jwt').ExtractJwt;","var jwt = require('jsonwebtoken'); // used to create, sign, and verify tokens","","var config = require('./config.js');"],"id":7}],[{"start":{"row":12,"column":49},"end":{"row":13,"column":0},"action":"insert","lines":["",""],"id":8},{"start":{"row":13,"column":0},"end":{"row":14,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":14,"column":0},"end":{"row":39,"column":68},"action":"insert","lines":["exports.getToken = function(user) {","    return jwt.sign(user, config.secretKey,","        {expiresIn: 3600});","};","","var opts = {};","opts.jwtFromRequest = ExtractJwt.fromAuthHeaderAsBearerToken();","opts.secretOrKey = config.secretKey;","","exports.jwtPassport = passport.use(new JwtStrategy(opts,","    (jwt_payload, done) => {","        console.log(\"JWT payload: \", jwt_payload);","        User.findOne({_id: jwt_payload._id}, (err, user) => {","            if (err) {","                return done(err, false);","            }","            else if (user) {","                return done(null, user);","            }","            else {","                return done(null, false);","            }","        });","    }));","","exports.verifyUser = passport.authenticate('jwt', {session: false});"],"id":9}]]},"timestamp":1541168006780}